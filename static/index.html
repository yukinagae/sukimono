<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<title>SUKIMONO</title>
	<link rel="stylesheet" type="text/css" href="css/sukimono.css">
</head>
<body>
	<div class="sidebar">
		<h1>SUKIMONO</h1>
		<form data-bind="submit: addNote">
			<ul>
				<li>Name</li>
				<li>
					<input data-bind="value: newName" style="width: 24rem;"/>
				</li>
				<li>Content</li>
				<li>
					<textarea data-bind="value: newContent" style="width: 24rem; height: 8rem;"></textarea>
				</li>
			</ul>
			<button type="submit">New</button>
			<hr/>
		</form>
	</div>
	
	<div class="content" data-bind="foreach: notes">
		<div class="note">
			<h4 data-bind="text: $data.Name"></h4>
			<hr/>
			<pre data-bind="text: $data.Content"></pre>
			<span class="done">&#x2715; done</span>
		</div>
	</div>

	<script type="text/javascript" src="js/knockout-3.2.0.js"></script>
	<script type="text/javascript" src="js/jquery-2.1.1.min.js"></script>
	<script type="text/javascript">

			var Model = Model || {};

			Model = {
				fn : {
					NoteModels : function() {
						var self = this;
						self.notes = ko.observableArray();
						self.newName = ko.observable("");
						self.newContent = ko.observable("");
						self.addNote = function() {
							var note = new Model.fn.NoteModel({});
							note.Name = self.newName();
							note.Content = self.newContent();
							$.post("/api/new", ko.toJSON(note), function(data) {
								Model.va.vmodel.notes.push(data);
							});
						}
					},
					NoteModel : function(data) {
						var self = this;
						self.Name = ko.observable(data.Name || '');
						self.Content = ko.observable(data.Content || '');
					},
					connect : function() {
						$.getJSON("/api/list", function (data) {
							data.forEach(function (row) {
								var note = new Model.fn.NoteModel(row);
								Model.va.vmodel.notes.push(note);
							});
						});
					},
				},
				va : {
					vmodel : null
				}
			}

			$(function() {
				Model.va.vmodel = new Model.fn.NoteModels();
				ko.applyBindings(Model.va.vmodel);
				Model.fn.connect();
			});

		</script>
	</body>
	</html>
